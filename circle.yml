machine:
  environment:
    PATH: /usr/local/bin/:${PATH}
  services:
    - docker
  pre:
    - curl -k -L -O http://ftp.gnu.org/gnu/make/make-4.1.tar.bz2 && tar xjf make-4.1.tar.bz2 && cd make-4.1 && ./configure && make && sudo make install
      
checkout:
  post:
    - git submodule sync
    - git submodule update --init
    - mkdir -p root/sbin
    - mkdir -p root/usr/bin
    - mkdir -p root/etc/s6
    
dependencies:
  override:
    - cd skalibs; ./configure && make && sudo make install
    - cd execline; ./configure && make && sudo make install
    - cd s6; ./configure --exec-prefix=./package && make && sudo make install && cp ./package/bin/* ../root/usr/bin/. && cp ./package/sbin/* ../root/sbin/.
    - cd nanomsg; sh autogen.sh && ./configure && make && make check && sudo make install
    - docker info
    - docker build -t quay.io/redsift/baseos .    
    
test:
  override:
    - docker run -d quay.io/redsift/baseos; sleep 10    